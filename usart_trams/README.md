# 🎯 自适应四元数3D可视化系统

一个功能强大的实时四元数3D可视化系统，具备革命性的**自适应速率匹配技术**，能够自动检测串口数据传输速率并动态调整渲染参数，实现完美丝滑的3D运动效果。

## ✨ 核心特性

### 🚀 自适应速率匹配技术
- **实时速率检测**: 自动检测串口数据传输速率 (1Hz - 1000Hz+)
- **动态渲染匹配**: 目标渲染频率 = 数据速率 × 2.5倍
- **智能插值调整**: 根据数据频率自动优化平滑参数
- **完美丝滑运动**: 消除所有卡顿、抖动和延迟

### 🎮 多种可视化方法
- **Open3D 3D可视化器**: 专业级3D引擎，完美视角控制
- **VPython 3D可视化器**: 轻量级Web界面，跨平台支持

### ⚡ 高性能优化
- **超响应**: 极低延迟的实时响应
- **SLERP插值**: 四元数球面线性插值，最平滑的旋转过渡
- **零漂抑制**: 增强互补滤波算法，消除传感器漂移
- **完美视角控制**: 支持鼠标旋转、平移、缩放

## 📦 安装要求

### Python环境
```bash
Python 3.8+
```

### 依赖包
```bash
pip install open3d numpy vpython pyserial asyncio
```

### 虚拟环境 (推荐)
```bash
python -m venv .venv
.venv\Scripts\activate  # Windows
source .venv/bin/activate  # Linux/Mac
pip install -r requirements.txt
```

## 🚀 快速开始

### 方式1: 统一启动器 (推荐)
```bash
python adaptive_visualizer_launcher.py
```

启动器提供：
- 2种可视化方法选择
- 8种串口配置选项
- 自适应技术详解
- 一键启动体验

### 方式2: 直接启动
```bash
# Open3D可视化器
python quaternion_3d_visualizer.py

# VPython可视化器
python enhanced_vpython_visualizer.py
```

## 🎯 自适应技术详解

### 工作原理
1. **实时监测**: 记录串口数据接收时间戳
2. **速率计算**: 计算平均数据间隔，得出实际传输速率
3. **动态调整**: 设置目标渲染速率 = 数据速率 × 2.5倍
4. **智能优化**: 根据数据频率动态调整插值参数

### 自适应插值策略
| 数据频率 | 插值因子 | 优化目标 |
|---------|---------|----------|
| ≥200Hz | 0.08 | 快速响应 |
| ≥100Hz | 0.12 | 平衡模式 |
| ≥50Hz  | 0.18 | 平滑优先 |
| <50Hz  | 0.25 | 最大平滑 |

### 技术优势
- ✅ **零配置**: 自动检测和调整，无需手动设置
- ✅ **通用性**: 支持任意数据频率的传感器
- ✅ **完美同步**: 渲染频率自动匹配数据频率
- ✅ **资源优化**: 避免过度渲染浪费CPU
## 📊 支持的配置

### 串口配置
| 端口 | 波特率 | 数据格式 | 适用场景 |
|------|--------|----------|----------|
| COM6 | 460800 | ASCII | 高速传感器 |
| COM12| 128000 | ASCII | 标准传感器 |
| COM3 | 115200 | ASCII | 通用配置 |
| COM4 | 230400 | ASCII | 中速传感器 |
| COM5 | 57600  | ASCII | 低速传感器 |

### 数据格式
- **ASCII格式**: `w,x,y,z` (逗号分隔的四元数)
- **二进制格式**: 16字节float32数据 (自动检测字节序)

## 🎮 操作控制

### Open3D可视化器
- **左键拖拽**: 旋转视角
- **右键拖拽**: 平移视图
- **滚轮**: 缩放视图
- **ESC**: 退出程序

### VPython可视化器
- **鼠标拖拽**: 旋转视角
- **右键拖拽**: 平移视图
- **滚轮**: 缩放视图
- **关闭浏览器标签**: 退出程序

## 📁 项目结构

```
usart_trams/
├── adaptive_visualizer_launcher.py    # 统一启动器
├── quaternion_3d_visualizer.py        # Open3D可视化器
├── enhanced_vpython_visualizer.py     # VPython可视化器
├── com12_port_checker.py              # 串口诊断工具
├── test_com12_binary.py               # 二进制数据测试
├── src/                               # 核心库
│   ├── config.py                      # 配置管理
│   ├── serial_manager.py              # 串口管理
│   ├── quaternion_processor.py        # 四元数处理
│   └── complementary_filter.py        # 互补滤波器
├── requirements.txt                   # 依赖包列表
└── README.md                         # 项目文档
```

## 🔧 高级功能

### 零漂抑制
- **增强互补滤波器**: 自动消除传感器漂移
- **定期基准重置**: 每4秒自动校准基准四元数
- **自适应权重**: 根据运动状态动态调整滤波参数

### 性能监控
- **实时FPS显示**: 监控渲染性能
- **数据速率统计**: 显示实际接收速率
- **自适应参数**: 显示当前插值因子和目标渲染速率

### 诊断工具
```bash
# 串口诊断
python com12_port_checker.py

# 二进制数据测试
python test_com12_binary.py
```
## 🎨 可视化效果

### 3D模型
- **传感器立方体**: 实时跟随四元数旋转
- **坐标轴**: XYZ参考系统
- **运动轨迹**: 彩色渐变轨迹线
- **实时信息**: 姿态角度和四元数数值

### 丝滑度优化
- **SLERP插值**: 四元数球面线性插值
- **连续渲染**: 即使无新数据也保持平滑
- **智能缓存**: 避免重复计算提高性能

## 🚨 故障排除

### 常见问题

**Q: 串口连接失败**
```
A: 1. 检查端口是否被其他程序占用
   2. 确认波特率设置正确
   3. 运行串口诊断工具检查
```

**Q: 模型不跟随运动**
```
A: 1. 确认数据格式设置正确 (ASCII/Binary)
   2. 检查四元数数据是否有效
   3. 查看控制台错误信息
```

**Q: 运动不够丝滑**
```
A: 1. 自适应技术会自动优化
   2. 等待2秒让系统检测数据速率
   3. 检查数据传输是否稳定
```

### 性能优化建议
- 使用较高的波特率 (460800+)
- 确保数据传输稳定
- 关闭不必要的后台程序
- 使用专用的USB串口适配器

## 🤝 贡献

欢迎提交Issue和Pull Request来改进项目！

## 📄 许可证

MIT License

## 🙏 致谢

感谢Open3D和VPython项目提供的优秀3D可视化库。

---

**🎯 享受完美丝滑的四元数3D可视化体验！**
